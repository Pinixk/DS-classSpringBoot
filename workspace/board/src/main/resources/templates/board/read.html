<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <th:block th:replace="~{/layout/basic::setContent(~{this::content})}">
    <th:block th:fragment="content">
      <h1 class="mt-4">Guestbook Read Page</h1>
      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">Bno</label>
        <input type="text" name="bno" class="form-control" th:value="${dto.bno}" readonly>
      </div>
      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">Title</label>
        <input type="text" name="title" class="form-control" th:value="${dto.title}" readonly>
      </div>
      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">Content</label>
        <textarea name="content" class="form-control" rows="5" readonly>[[${dto.content}]]</textarea>
      </div>
      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">Writer Name</label>
        <input type="text" name="writerName" class="form-control" th:value="${dto.writerName}" readonly>
      </div>

      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">RegDate</label>
        <input type="text" class="form-control" th:value="${#temporals.format(dto.regDate,'yyyy/MM/dd HH:mm:ss')}" readonly>
      </div>
      <div class="form-group"  style="margin-bottom: 13px;">
        <label for="">ModDate</label>
        <input type="text" class="form-control" th:value="${#temporals.format(dto.modDate,'yyyy/MM/dd HH:mm:ss')}" readonly>
      </div>

      <div class="form-group"  style="margin-bottom: 13px;">
        <button type="button" class="btn btn-primary" th:onclick="|location.href=
          '@{/board/modify(bno=${dto.bno},page=${requestDTO.page},type=${requestDTO.type},
          keyword=${requestDTO.keyword})}'|">Modify</button>

        <button type="button" class="btn btn-info" th:onclick="|location.href=
          '@{/board/list(page=${requestDTO.page},type=${requestDTO.type},
          keyword=${requestDTO.keyword})}'|">List</button>
      </div>

      <div class="form-group">
        <div class="mt-4">
          <h5><span class="btn btn-info badge badge-secondary replyCount">
            Reply Count [[${dto.replyCount}]]</span></h5>
        </div>
        <div class="list-group replyList"></div>
      </div>


      <div id="myModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Modal title</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </button>
            </div>
            <div class="modal-body">
              <p>Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <!-- <button type="button" class="btn btn-primary"> Save changes </button> -->
            </div>
          </div>
        </div>
      </div>
   
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <script th:inline="javascript">
        window.onload = function(){
          var msg = /*[[${msg}]]*/ "msg";
          
          if (msg) {

            const bno = msg.split(" ")[0];
            const noti = msg.split(" ")[1];
            
            console.log(msg);
            var myModal = new bootstrap.Modal(document.getElementById('myModal'),
              { backdrop: true })
            document.querySelector(".modal-title").textContent=noti+' 완료'
            document.querySelector(".modal-body").innerHTML=
              `<p>${bno}번 글이 ${noti}되었습니다.</p>`
            myModal.show();
          }
          
          const bno = /*[[${dto.bno}]]*/'bno'
        const url = /*[[@{/replies/board/}]]*/'url';
        var listGroup = document.querySelector(".replyList");
        function formatTime(str){
          var date = new Date(str);
          return date.getFullYear()+'/'+
                  (date.getMonth()+1)+'/'+
                  date.getDate()+ ' ' +
                  date.getHours() + ':' +
                  date.getMinutes();
        }
        function loadJSONData(){
          axios({
                method:"GET",
                url: 'http://localhost:8080'+url+bno
          }).then( function(res){
            let str = '';
            for (const reply of res.data) {
              str += 
              `<div class="card-body form-control" data-rno="${reply.rno}">
                <b>${reply.rno}</b>
                <h5 class="card-title">${reply.text}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${reply.replyer}</h6>
                <p class="card-text">${formatTime(reply.regDate)}</p>
              </div>`
            }
            listGroup.innerHTML = str
          }).catch(function(err){console.log(err)});
        }
        loadJSONData()
      }
      </script>

    </th:block>
  </th:block>
</html>
